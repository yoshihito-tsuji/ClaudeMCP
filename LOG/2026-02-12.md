# LOG: 2026-02-12

---

## [DECISION] - 決定事項

### LOG_00017 Yoshihitoさん

- **決定内容**: kmizu/embodied-claude からの同期は今回を最後とし、以後 upstream 同期を行わず独立開発とする
- **理由**: 上流リポジトリの変更に依存せず、自分のペースで開発を進めたいため
- **影響**: README.md の更新方針（上流の変更を取り込まない）、未実装機能は独自に実装判断する、リポジトリ管理（upstream remote 未設定のまま維持）
- **DECISIONS.md転記**: [x] 要

---

## [RUNLOG] - 実行記録

### LOG_00018 ClaudeCode

- **目的**: ルート README.md を上流リポジトリ（kmizu/embodied-claude）の最新情報に基づいて更新
- **方法**: 上流の README.md をフェッチし、ローカルの実ディレクトリ構造と比較して差分を反映
- **実装内容**:
  - 身体パーツ一覧・ディレクトリ構造・ツール一覧を更新
  - 「外に連れ出す」「今後の展望」セクションを追加
  - 自律行動スクリプトの説明を強化
  - 謝辞に Rumia-Channel、sugyan を追加
- **結果**: 成功
- **変更ファイル**:
  - README.md（更新）
- **追記事項**: これが上流からの最後の情報取り込みとなる

### LOG_00019 ClaudeCode

- **目的**: ドキュメント整合性監査（README群と実装の不一致を洗い出し）
- **方法**: 各サーバーの server.py の list_tools 定義とREADMEのツール名を照合
- **実装内容**:
  - 全5サーバーのツール定義を実装から抽出し、README記載と比較
  - 差分一覧を重大度（High/Medium/Low）付きで作成
- **結果**: High 6件、Medium 8件、Low 5件の不一致を検出
- **変更ファイル**: なし（調査のみ）
- **追記事項**: wifi-cam-mcp/README.md が最も乖離が大きかった（旧名9ツール vs 実装23ツール）

### LOG_00020 ClaudeCode

- **目的**: ルート README.md の未実装ツール記載を修正
- **方法**: 実装に存在しないツール3つを実装済み一覧から除外し、「実装予定（Planned）」として分離。ONVIF/go2rtc/Audio Tags の実装根拠なしの断定表現を修正
- **実装内容**:
  - memory-mcp の `recall_divergent`、`consolidate_memories`、`get_association_diagnostics` を実装予定セクションに移動
  - wifi-cam-mcp の「ONVIF」表記を削除（実装にONVIF対応コードなし）
  - elevenlabs-t2s-mcp の「Audio Tags対応」「go2rtc」表記を削除（実装に該当コードなし）
- **結果**: 成功
- **変更ファイル**:
  - README.md（修正）

### LOG_00021 ClaudeCode

- **目的**: サブプロジェクト README を実装準拠に整備
- **方法**: 各 server.py の list_tools と pyproject.toml の [project.scripts] を照合し、README を書き直し/新規作成
- **実装内容**:
  - wifi-cam-mcp/README.md: 全面書き直し（旧名9ツール → 実装準拠23ツール、環境変数一覧拡充）
  - memory-mcp/README.md: 全面書き直し（旧名5ツール → 実装準拠17ツール、LinkType・エピソード・感覚・作業記憶を記載）
  - elevenlabs-t2s-mcp/README.md: 新規作成（sayツール仕様、環境変数9項目、再生バックエンド設定）
- **結果**: 成功。全3サーバーでツール名・起動コマンドの一致を確認済み
- **変更ファイル**:
  - wifi-cam-mcp/README.md（全面書き直し）
  - memory-mcp/README.md（全面書き直し）
  - elevenlabs-t2s-mcp/README.md（新規作成）
- **追記事項**: 残課題として CLAUDE.md のディレクトリ構造更新（High）が残っている → LOG_00022 で対応済み

### LOG_00022 ClaudeCode

- **目的**: CLAUDE.md のディレクトリ構造とパス表記を実態に合わせて更新
- **方法**: 実際のファイルシステム構造を調査し、CLAUDE.md の記載と照合して差分を修正
- **実装内容**:
  - ディレクトリ構造を全面更新:
    - `wifi_cam_mcp/`（アンダースコア）→ `wifi-cam-mcp/`（ハイフン）に修正
    - wifi-cam-mcp に `src/` パスを追加
    - memory-mcp に `episode.py`, `sensory.py`, `working_memory.py`, `tests/` を追加
    - elevenlabs-t2s-mcp に `config.py` を追加
    - `installer/`, `docs/`, `LOG/`, `DECISIONS.md`, `AGENTS.md` をツリーに追加
    - 各サーバーにツール数を注釈（23, 17, 1ツール）
  - セクション見出しの修正: `wifi_cam_mcp` → `wifi-cam-mcp`（2箇所）
  - typo 修正: `squash Wi-Fi カメラ` → `# Wi-Fi カメラ`（167行目）
  - パス修正: `cd wifi_cam_mcp` → `cd wifi-cam-mcp`（175行目）
  - テーブル区切り線スタイルを統一（markdown lint 対応）
- **結果**: 成功
- **変更ファイル**:
  - CLAUDE.md（更新）

### LOG_00023 ClaudeCode

- **目的**: Best Practice / UI/UX心理学の参照要件を「必須（MUST）」として明文化
- **方法**: 参照元を CLAUDE.md に一元化し、他ファイルからはリンクで参照する構成に整理
- **実装内容**:
  - CLAUDE.md: 冒頭に「セッション開始時の必須参照（MUST）」セクションを追加（参照順序・パス・目的を明記）
  - README.md: AI起動時の記述を MUST 文言に統一し、CLAUDE.md への参照リンクに集約
  - claude_code_role.md: Startup Procedure にステップ3「Best Practice / UI/UX心理学を読み込む（MUST）」を追加
  - codex_role.md: 同上
  - LOG_TEMPLATE.md: 「[STARTUP] - 起動時参照確認」チェック欄を追加（4項目）
- **結果**: 成功。全8参照リンク（相対パス）の存在を検証済み
- **変更ファイル**:
  - CLAUDE.md（更新）
  - README.md（更新）
  - docs/team_ops/claude_code_role.md（更新）
  - docs/team_ops/codex_role.md（更新）
  - docs/team_ops/LOG_TEMPLATE.md（更新）

### LOG_00024 ClaudeCode

- **目的**: LOG_00023 報告の正確性補正（Codex指摘2点）
- **方法**: README.md の直接リンク列挙を削除し CLAUDE.md への一元参照を実体と一致させる
- **実装内容**:
  - README.md: 「開発方法論の詳細」セクションから Best Practice / UI/UX心理学 / Codex向けガイドの直接リンクを削除。Dev-Rules リンクのみ残し、AI起動時の必須手順は CLAUDE.md への一本参照に集約（方針A採用）
- **結果**: 成功
- **変更ファイル**:
  - README.md（更新）
  - LOG/2026-02-12.md（追記）

### LOG_00025 ClaudeCode

- **目的**: Phase 1 行動記憶 `remember_action` ツール実装 + 口調方針の確定反映
- **方法**: Codex 統合タスク仕様に基づき、types.py に Category.ACTION 追加、server.py に Tool 定義 + call_tool ハンドラ追加。AGENTS.md の口調方針を更新
- **実装内容**:
  - `memory-mcp/src/memory_mcp/types.py`: Category enum に `ACTION = "action"` を追加
  - `memory-mcp/src/memory_mcp/server.py`:
    - `remember_action` ツール定義（必須: tool_name, parameters_summary, result_summary、オプション: status, reasoning, importance, related_memory_id）
    - `remember_action` ケースハンドラ（importance デフォルト: success=2, partial=3, failure=4、構造化テキスト生成、auto link 対応）
    - 全3箇所の category enum リストに `"action"` を追加
  - `AGENTS.md`: 口調をカジュアル標準語（～だよ/～だね/～かな）に明文化、幼馴染設定維持
  - `DECISIONS.md`: 行動記憶 Phase 1 決定 + 口調方針決定の2件を追記
  - `CLAUDE.md`: memory-mcp ツール一覧に `remember_action` 追加、Category に `action` 追加
  - `README.md`: memory-mcp セクションに行動記憶テーブル追加、Category に `action` 追加
  - `memory-mcp/README.md`: ツール数 17→18、行動記憶ツールセクション追加、Category に `action` 追加
- **結果**: 成功。構文チェック通過、ツール定義18件 / ハンドラ18件で完全一致を確認
- **変更ファイル**:
  - memory-mcp/src/memory_mcp/types.py（修正）
  - memory-mcp/src/memory_mcp/server.py（修正）
  - AGENTS.md（修正）
  - DECISIONS.md（追記）
  - CLAUDE.md（修正）
  - README.md（修正）
  - memory-mcp/README.md（修正）
  - LOG/2026-02-12.md（追記）
- **追記事項**: uv が未インストールのため pytest 実行は未実施。構文チェック + ツール数照合で検証。Phase 2（自動記録）は将来フェーズで検討

### LOG_00026 ClaudeCode

- **目的**: Codex差し戻し — `remember_action` ハンドラの実行時エラー修正
- **方法**: `self._memory_store.link_memories(...)` を `self._memory_store.add_causal_link(...)` に置換（`memory.py` に `link_memories` メソッドは存在せず、`add_causal_link` が正しいAPI）
- **実装内容**:
  - `memory-mcp/src/memory_mcp/server.py` 1095行: `link_memories` → `add_causal_link` に修正。合わせて f-string の不要な `f` プレフィックスを削除
- **結果**: 成功
- **変更ファイル**:
  - memory-mcp/src/memory_mcp/server.py（修正: 1095行）
  - LOG/2026-02-12.md（追記）
- **検証結果**:
  - `python3 -m py_compile server.py`: OK
  - `python3 -m py_compile memory.py`: OK
  - ツール定義 18件 / ハンドラ 18件: 一致
  - `link_memories` 呼び出しは正当なツールハンドラ内（989行）のみ、`remember_action` 内は `add_causal_link` に統一
  - `uv` 未インストールのため `pytest` は実行不可

### LOG_00027 ClaudeCode

- **目的**: 概日リズム Phase 1 実装（ソフトウェアのみ、ハード不要）
- **方法**: system-temperature-mcp に `get_circadian_state` ツールを追加。autonomous-action.sh に daypart 判定とプロンプト分岐を追加。環境変数で閾値を設定可能に
- **実装内容**:
  - `system-temperature-mcp/src/system_temperature_mcp/server.py`:
    - `import os` 追加
    - `_parse_time()`, `_time_to_minutes()`, `get_circadian_config()`, `get_circadian_state()` 関数を追加
    - `get_circadian_state` ツール定義 + call_tool ハンドラ追加
    - 返却項目: local_time, daypart, recommended_observation_interval_min, greeting_tone, memory_importance_bias, circadian_enabled
  - `autonomous-action.sh`:
    - daypart 判定ロジック追加（bash の `to_minutes` 関数 + 分岐）
    - `CIRCADIAN_ENABLED=true` 時に daypart に応じたプロンプトヒントを追加（morning: bright / day: normal / evening: calm / night: quiet）
    - ログ出力に `[daypart=...]` を付加
    - 未設定時は従来互換（DAYPART_HINT が空 → プロンプトに追加なし）
  - 環境変数:
    - `CIRCADIAN_ENABLED`（default: true for MCP / false for shell）
    - `CIRCADIAN_TIMEZONE`（default: Asia/Tokyo）
    - `CIRCADIAN_MORNING_START`（default: 05:00）
    - `CIRCADIAN_DAY_START`（default: 10:00）
    - `CIRCADIAN_EVENING_START`（default: 18:00）
    - `CIRCADIAN_NIGHT_START`（default: 22:00）
  - `README.md`: system-temperature-mcp ツール一覧に `get_circadian_state` 追加、「概日リズム対応（Phase 1）」セクション追加（env 一覧 + daypart テーブル）
  - `CLAUDE.md`: ツール一覧に追加 + 概日リズム運用ルール1段落追記
  - `DECISIONS.md`: 概日リズム Phase 1 開始の決定を追記
- **結果**: 成功
- **変更ファイル**:
  - system-temperature-mcp/src/system_temperature_mcp/server.py（修正）
  - autonomous-action.sh（修正）
  - README.md（修正）
  - CLAUDE.md（修正）
  - DECISIONS.md（追記）
  - LOG/2026-02-12.md（追記）
- **検証結果**:
  - `python3 -m py_compile server.py`: OK
  - ツール定義 3件 / ハンドラ 3件: 一致
  - Python daypart 境界テスト（13ケース）: ALL PASSED
  - Bash daypart 境界テスト（10ケース）: ALL PASSED
  - Python / Bash のロジック一致を確認
  - `uv` 未インストールのため `pytest` は実行不可
- **追記事項（Phase 2 候補）**:
  - 夜間の cron 実行頻度変更（*/30 に切り替え）の自動化
  - greeting_tone に応じた `say` の voice パラメータ連動
  - memory_importance_bias の `remember` 呼び出しへの自動適用
  - 季節変動（日照時間による daypart 自動調整）

### LOG_00028 ClaudeCode

- **目的**: Codex差し戻し — autonomous-action.sh の allowedTools 旧ツール名修正 + README デフォルト値明記
- **方法**: autonomous-action.sh の allowedTools を現行ツール名に更新。README.md の CIRCADIAN_ENABLED デフォルト値を MCP/Shell で分けて明記
- **実装内容**:
  - `autonomous-action.sh` 83行: allowedTools を旧名から現行名に更新
    - `camera_capture` → `see`
    - `camera_pan_left` → `look_left`
    - `camera_pan_right` → `look_right`
    - `camera_tilt_up` → `look_up`
    - `camera_tilt_down` → `look_down`
    - `camera_look_around` → `look_around`（変更なし）
    - `save_memory` → `remember`
    - `search_memories`, `recall`, `list_recent_memories` は変更なし
  - `README.md`: CIRCADIAN_ENABLED デフォルト値を `MCP: true / Shell: false` に明記
  - PROMPT テキスト内に `save_memory` への直接参照なしを確認（自然言語のみ）
- **結果**: 成功
- **変更ファイル**:
  - autonomous-action.sh（修正: 83行）
  - README.md（修正: CIRCADIAN_ENABLED デフォルト値）
  - LOG/2026-02-12.md（追記）
- **検証結果**:
  - `grep -E "camera_capture|camera_pan_|camera_tilt_|save_memory"` でプロジェクト全体を検索 → autonomous-action.sh 内にヒットなし（test_memory.py のdocstringのみ、問題なし）
  - allowedTools に記載の10ツール名が全て現行の wifi-cam-mcp / memory-mcp のツール定義と一致

### LOG_00029 ClaudeCode

- **目的**: From/To ヘッダー規約を CLAUDE.md / AGENTS.md に直接明記（コンテキスト復元時の適用漏れ対策）
- **方法**: Codex 指示に基づき案A（CLAUDE.md に直接記載）を採用。AGENTS.md にも最小限追記。既存ドキュメントに整合注記を追加
- **背景**: コンテキスト継続復元時に Startup Procedure が実行されず、claude_code_role.md にしか記載のなかった From/To 規約に到達できない問題が発覚（Yoshihitoさん指摘）
- **実装内容**:
  - `CLAUDE.md`: 「コミュニケーション形式（MUST）」セクションを新設（必須参照セクション直後）。From/To テンプレート、「コンテキスト復元時にも必須」を明記
  - `AGENTS.md`: 発話スタイルに「AI発信メッセージは From/To ヘッダー必須（コンテキスト復元時を含む）」を1行追記。詳細は CLAUDE.md 参照
  - `docs/team_ops/claude_code_role.md`: 既存の From/To 規約行に「コンテキスト復元時も必須。CLAUDE.md にも同規約を明記済み」を追記
  - `docs/team_ops/triad_collaboration.md`: 同上
- **結果**: 成功
- **変更ファイル**:
  - CLAUDE.md（新セクション追加）
  - AGENTS.md（1行追記）
  - docs/team_ops/claude_code_role.md（整合注記追加）
  - docs/team_ops/triad_collaboration.md（整合注記追加）
  - LOG/2026-02-12.md（追記）
- **整合確認**:
  - CLAUDE.md: 自動読み込みされるため、コンテキスト復元時にも From/To 規約に到達可能
  - AGENTS.md: 自動読み込みされるため、同上
  - claude_code_role.md / triad_collaboration.md: 既存規約と意味的に一致、重複ではなく補強
  - 4ファイル間で From/To 規約の記述に矛盾なし
