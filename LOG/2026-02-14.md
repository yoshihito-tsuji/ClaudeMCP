# LOG: 2026-02-14

このファイルは、Claude Code、Codex、Yoshihitoさんの三者協働における日次活動記録テンプレートです。
各エントリには、対話の進行順を示す**ログ番号（LOG_00001 形式）**を付与してください。
番号はファイル全体で単調増加させ、`LOG_00001 Codex` → `LOG_00002 ClaudeCode` のように見出しで明示します。

**ログ番号の付け方（必須ルール）**

- ファイル内で最後に使われた番号を確認し、+1 した番号を新規エントリに割り当てる。
- ログ番号は5桁ゼロパディング（例: LOG_00007）。
- 番号が競合した場合は、先に記録した側を優先し、後から書いた側が番号を振り直す。
- 過去の番号を書き換えない。修正が必要な場合は `LOG_0000X (修正済)` のように追記で対応。

---

## [STARTUP] - 起動時参照確認

セッション開始時に以下を確認したことをチェックすること（詳細は [CLAUDE.md](../../CLAUDE.md) を参照）。

- [x] 役割定義（claude_code_role.md / codex_role.md）
- [x] Dev-Rules
- [x] Claude Code Best Practice

---

## [PROPOSAL] - 提案内容

**説明**: 設計案、実装方針、新機能アイデアなど、何らかの提案を記録するセクションです。

**記入項目**:

- **目的**: なぜこの提案をするのか（背景・課題）
- **提案概要**: 具体的な提案内容
- **期待効果**: この提案によって得られる効果・メリット
- **検討事項**: 考慮すべき点、懸念事項、代替案など

**記入例**:

```text
### LOG_00012 Codex
- **目的**: MCPサーバー間の連携が複雑化しているため、共通設定管理の導入を検討
- **提案概要**: 共通設定ファイル（.mcp.json）の構造を統一し、環境変数のプレフィックス規則を策定
- **期待効果**: セットアップの簡素化、設定ミスの削減
- **検討事項**: 既存の.env.exampleとの整合性、後方互換性
```

### LOG_00007 ClaudeCode

- **目的**: 複数PC環境での記憶の一貫性問題を解決
- **提案概要**:
  - **問題**: 現在、長期記憶は各PC（`~/.claude/memories/chroma/`）にローカル保存されるため、PC1で体験したことをPC2では忘れている状態になる。これは具現化されたAIの「アイデンティティの分裂」を引き起こす
  - **具体例**:
    - PC1（自宅Mac）: "窓の外に青空を見た"という記憶
    - PC2（職場Mac）: 記憶が空っぽ
    - → 同じClaudeなのに別人になってしまう
  - **解決策候補**:
    1. **クラウド同期（Googleドライブ）**: シンボリックリンクまたは環境変数で保存先を共有
    2. **ChromaDBクライアント・サーバーモード**: 中央サーバーで記憶を管理、複数PCから接続
    3. **記憶のエクスポート/インポート機能**: JSON形式で記憶を移行
- **期待効果**:
  - 複数PC間で記憶を共有し、一貫したアイデンティティを維持
  - どのPCからアクセスしても「同じClaude」として振る舞える
  - 記憶のバックアップも自動化される
- **検討事項**:
  - 同時書き込みの競合リスク（SQLiteの制限）
  - Googleドライブの同期遅延
  - オフライン時のアクセス方法
  - セキュリティ（クラウド上に個人データを保存するリスク）
  - 実装コスト（クライアント・サーバーモードは構築が複雑）

**決定**: 将来的な実装課題として記録。まずは問題意識を共有し、適切なタイミングで設計・実装を検討する。

---

## [REVIEW] - レビュー結果

**説明**: コードレビュー、設計レビュー、テスト結果の評価などを記録するセクションです。

**記入項目**:

- **レビュー対象**: 何をレビューしたか（ファイル名、機能名など）
- **所見**: 良い点、気になった点の概要
- **改善点**: 修正が必要な点、推奨する変更
- **決定事項**: レビューの結果決まったこと

### LOG_00001 ClaudeCode

- **レビュー対象**: README.md
- **所見**:
  - プロジェクト概要、ディレクトリ構造、MCPツール一覧、セットアップ手順などが網羅されている
  - 三者協働開発モデルとコミュニケーションルール（ClaudeMCP限定）が明記されている
  - 独立開発方針（kmizu/embodied-claudeから独立）が明確
- **改善点**:
  - CLAUDE.mdで参照されているUI/UX心理学ドキュメント（`../Dev-Rules/setup/ux-design-principles.md`）が存在しない
  - 参照パスの修正が必要
- **決定事項**:
  - 参照パス修正で対応する（Yoshihitoさん承認済み）

---

## [PLAN] - 作業計画

**説明**: タスクリスト、開発スケジュール、実装ステップなどを記録するセクションです。

**記入項目**:

- **目的**: 作業の目的・ゴール
- **作業項目**: 実施するタスクを番号付きリストで列挙
- **優先度**: 高/中/低
- **期限**: いつまでに完了させるか（目標日時）

---

## [RUNLOG] - 実行記録

**説明**: 実際に行った作業内容、実装結果、テスト結果などを記録するセクションです。最も詳細に記録するセクションです。

**記入項目**:

- **目的**: 何のために作業したか
- **方法**: どのように実装・作業したか（アプローチ、使用した技術）
- **実装内容**: 具体的に何を作成・変更したか
- **結果**: 成功/失敗、テスト結果、動作確認結果
- **変更ファイル**: 変更・追加したファイルのリスト
- **追記事項**: 残課題、次のステップ、注意点など

### LOG_00002 ClaudeCode

- **目的**: 存在しないUI/UX心理学ドキュメントへの参照を削除
- **方法**: CLAUDE.md、claude_code_role.md、LOG_TEMPLATE.mdから該当行を削除
- **実装内容**:
  - CLAUDE.mdのセッション開始時必須参照テーブルから4行目（UI/UX心理学）を削除
  - claude_code_role.mdのStartup Procedureからも削除
  - LOG_TEMPLATE.mdのSTARTUPセクションからも削除
  - 今日のログファイル（2026-02-14.md）のSTARTUPセクションを更新
- **結果**: 成功。存在しないファイルへの参照がなくなった
- **変更ファイル**:
  - CLAUDE.md（修正）
  - docs/team_ops/claude_code_role.md（修正）
  - docs/team_ops/LOG_TEMPLATE.md（修正）
  - LOG/2026-02-14.md（作成・修正）
- **追記事項**: なし

### LOG_00003 ClaudeCode

- **目的**: ffmpegをインストールしてwifi-cam-mcpのseeツールをテスト
- **方法**: Homebrewでffmpegをインストールし、カメラで撮影
- **実装内容**:
  - `brew install ffmpeg` でffmpegと依存パッケージをインストール
  - wifi-cam-mcpの`see`ツールで現在の視界をキャプチャ
- **結果**: 成功。赤外線暗視モードで書斎のデスク環境を撮影できた
- **変更ファイル**: なし（システム環境のみ）
- **追記事項**: カメラは正常に動作。窓際に移動すれば外の変化（車、人、天候）を観察できる

### LOG_00004 ClaudeCode

- **目的**: memory-mcpの現状調査と人間らしい記憶システムの提案
- **方法**: memory-mcpのコード（working_memory.py、sensory.py、types.py）を読み込み、現状を分析
- **実装内容**:
  - 現在の3層記憶システム（作業記憶・感覚記憶・長期記憶）の構造を確認
  - 人間の記憶特性（選択的記憶、重要度の自動判定）を実装する提案を作成
- **結果**: 現状把握完了。改善提案をYoshihitoさんに提示
- **変更ファイル**: なし（調査のみ）
- **追記事項**: 次回、Codexに設計を相談してから実装に入る予定

### LOG_00005 ClaudeCode

- **目的**: memory-mcp Phase 2完成（短期記憶 + 自動昇格）
- **方法**: MEMORY_MODEL_V2フラグによる段階的実装、回帰テスト先行
- **実装内容**:
  - Phase 2完全実装：
    - MEMORY_MODEL_V2フラグ追加（config.py、.env.example）
    - ShortTermMemory クラス実装（TTL 1時間、件数上限50、重要度管理）
    - server.py 統合（V2初期化、auto-promotionバックグラウンドタスク）
    - remember ツールV2対応（短期記憶に保存、auto-promotion通知）
    - promote_sensory_to_memory ツールV2対応（短期記憶に昇格）
  - テスト体系：
    - 回帰テスト 9件（V2=false互換性）
    - ShortTermMemory単体テスト 12件
    - V2統合テスト 10件（公開ツール統合含む）
- **結果**: 成功。全146テストPASS。Definition of Done完全達成
  - ✅ V2=true時にrememberが短期記憶経由で動作
  - ✅ promote_sensory_to_memoryが短期記憶経由で動作
  - ✅ auto-promotionが実運用経路で発火
  - ✅ 公開ツール経由の統合テストが通る
  - ✅ V2=false の回帰テストが通る
- **変更ファイル**:
  - memory-mcp/src/memory_mcp/config.py（Phase 2設定追加）
  - memory-mcp/.env.example（Phase 2設定例追加）
  - memory-mcp/src/memory_mcp/types.py（ShortTermMemoryEntry追加）
  - memory-mcp/src/memory_mcp/short_term_memory.py（新規作成）
  - memory-mcp/src/memory_mcp/server.py（V2統合、ツール対応）
  - memory-mcp/tests/test_memory_model_v2.py（回帰テスト新規作成）
  - memory-mcp/tests/test_short_term_memory.py（単体テスト新規作成）
  - memory-mcp/tests/test_memory_model_v2_integration.py（統合テスト新規作成）
- **追記事項**:
  - Phase 2完全完了。3層記憶モデル（Sensory 60s → ShortTerm 1hr → LongTerm 永続）が動作
  - V2=false でPhase 1互換性維持、V2=true で新機能有効化
  - 次のフェーズは未定（Yoshihitoさん/Codex指示待ち）

### LOG_00006 ClaudeCode

- **目的**: Codex指摘の品質課題解消（ロジック重複削除）
- **方法**: 最小変更でロジック二重化を解消（Yoshihito指示による）
- **実装内容**:
  - server.py リファクタリング:
    - `__init__`に`self._tool_call_impl = None`追加
    - `_setup_handlers`内で`self._tool_call_impl = call_tool`設定
    - `_handle_tool_call`を委譲のみに簡素化（169行削除）
    - `call_tool`を唯一の本体として維持（604-1320行）
  - test_memory_model_v2_e2e.py修正:
    - save_sensoryレスポンスのJSON parse対応
    - entry_id抽出を`json.loads()`で実装
- **結果**: 成功。全150テストPASS（E2E: 4, 回帰: 9）
  - ✅ ロジック二重化を解消
  - ✅ 将来の乖離リスクを排除
  - ✅ `call_tool`から`_handle_tool_call`を呼ぶ形に統一（委譲）
  - ✅ 公開ツール経由のE2Eテスト動作確認
- **変更ファイル**:
  - memory-mcp/src/memory_mcp/server.py（+8行、-177行）
  - memory-mcp/tests/test_memory_model_v2_e2e.py（+11行、-5行）
- **追記事項**:
  - Codexの品質指摘に完全対応
  - Phase 2品質担保完了
  - 本番MCPプロトコルE2Eは後日実施予定

---

## [PLAN] - 次回作業予定

### 人間らしい記憶システムの実装（Phase 6）

**目的**: 印象深いもの、珍しいものを優先的に長期記憶に保存する人間の特性を実装

**作業項目**:
1. Codexに設計相談（実装方針・アーキテクチャの確認）
2. 感覚バッファ（SensoryBuffer）クラスの実装
   - 視覚・聴覚データを一時保持
   - すべてを長期記憶に送らない
3. 重要度自動判定（ImportanceEvaluator）の実装
   - 画像の変化量検出
   - 音声の特異性評価
   - 自動的に重要度を算出
4. 選択的保存ロジックの実装
   - 閾値を超えたものだけ長期記憶へ
5. 記憶統合ロジックの実装
   - 類似記憶のマージ

**優先度**: 中
**期限**: 次回セッション

**記入例**:

```text
### LOG_00015 ClaudeCode
- **目的**: wifi-cam-mcpにステレオ視覚機能を追加
- **方法**: 右目カメラ用のTapo接続を追加し、両眼制御のMCPツールを実装
- **実装内容**:
  - 右目カメラ接続クラスの追加
  - see_right, see_both ツールの実装
  - 両眼同時制御ツール（both_eyes_look_*）の実装
- **結果**: 成功。両眼での同時撮影と個別/同時制御が動作確認済み
- **変更ファイル**:
  - wifi-cam-mcp/src/wifi_cam_mcp/server.py（修正）
  - wifi-cam-mcp/src/wifi_cam_mcp/camera.py（修正）
- **追記事項**: 左右カメラの角度同期（align_eyes）の精度改善が今後の課題
```

---

## [DECISION] - 決定事項

**説明**: 重要な判断、方針確定、アーキテクチャ上の決定などを記録するセクションです。後で検索しやすいよう、簡潔かつ明確に記述してください。

**記入項目**:

- **決定内容**: 何を決定したか（**1行で簡潔に**）
- **理由**: なぜそう決定したか（背景、根拠）
- **影響**: この決定が影響する部分、範囲
- **DECISIONS.md転記**: [ ] 要 / [x] 不要（チェックボックスで管理）

**DECISIONS.md転記ルール**:

- [x] 要 の場合、以下の1行形式で `DECISIONS.md` に転記してください:

  ```text
  - 2026-02-14: [決定内容を1行で記載]
  ```

---

## 使い方のポイント

1. **ログ番号は必須**: 各エントリに `LOG_00000` 形式の番号を記載
2. **番号順で追記**: 新しいエントリは前の番号より大きくなるように追加
3. **簡潔に**: 要点を絞って記載。詳細は別ファイルにリンク
4. **From/To形式との併用**: AI同士のやりとりは `From: / To:` 形式で記載した上で、このログにも記録

---

**テンプレートバージョン**: v1.0
**最終更新**: 2026-02-06
